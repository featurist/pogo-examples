<html>
  <head>
    <title>Pogo Examples</title>
    <link rel="stylesheet" type="text/css" href="samples.css" />
    <link rel="stylesheet" type="text/css" href="highlight.css" />
  </head>
  <body>
    <a href="https://github.com/featurist/pogo-examples">
      <img style="position: absolute; top: 0; right: 0; border: 0;" src="http://s3.amazonaws.com/github/ribbons/forkme_right_darkblue_121621.png" alt="Fork me on GitHub" />
    </a>
    <h1>PogoScript to JavaScript Examples</h1>
    <p>
      Side-by-side examples of <a href="http://pogoscript.org">PogoScript</a> compiling to JavaScript.
    </p>
    <table>
      
      <tr>
        <th colspan="2"><h2>Arrays</h2></th>
      </tr>
      <tr>
        <td class="pogo">
          <div class="scrollable">
            <pre><code>array one <span class="operator">=</span> [<span class="number">1</span><span class="operator">,</span> <span class="string">"two"</span>]

array two <span class="operator">=</span> [
    <span class="number">3</span>
    <span class="string">"four"</span>
]</code></pre>
          </div>
        </td>
        <td class="javascript">
          <div class="scrollable">
            <pre><code><span class="keyword">var</span> arrayOne, arrayTwo;

arrayOne = [ <span class="number">1</span>, <span class="string">"two"</span> ];

arrayTwo = [ <span class="number">3</span>, <span class="string">"four"</span> ];</code></pre>
          </div>
        </td>
      </tr>
      
      <tr>
        <th colspan="2"><h2>Blocks Preserve Self</h2></th>
      </tr>
      <tr>
        <td class="pogo">
          <div class="scrollable">
            <pre><code>person <span class="operator">=</span> {

    name <span class="operator">=</span> <span class="string">'Man Ray'</span>

    say hi later() <span class="operator">=</span>
        set
            console. log <span class="string">"my name is #(self.name)"</span>
        timeout <span class="number">123</span>

}

not using an arrow
    means (<span class="keyword">self</span>) is not always (this)

using an arrow <span class="operator">=></span>
    means (<span class="keyword">self</span>) is always (this)</code></pre>
          </div>
        </td>
        <td class="javascript">
          <div class="scrollable">
            <pre><code><span class="keyword">var</span> person;

person = {
    name: <span class="string">"Man Ray"</span>,
    sayHiLater: <span class="function"><span class="keyword">function</span><span class="params">()</span> {</span>
        <span class="keyword">var</span> self = <span class="keyword">this</span>;
        <span class="keyword">return</span> setTimeout(<span class="function"><span class="keyword">function</span><span class="params">()</span> {</span>
            <span class="keyword">return</span> console.log(<span class="string">"my name is "</span> + self.name);
        }, <span class="number">123</span>);
    }
};

notUsingAnArrow(<span class="function"><span class="keyword">function</span><span class="params">()</span> {</span>
    <span class="keyword">return</span> meansIsNotAlways(self, <span class="keyword">this</span>);
});

usingAnArrow(<span class="function"><span class="keyword">function</span><span class="params">()</span> {</span>
    <span class="keyword">var</span> self = <span class="keyword">this</span>;
    <span class="keyword">return</span> meansIsAlways(self, <span class="keyword">this</span>);
});</code></pre>
          </div>
        </td>
      </tr>
      
      <tr>
        <th colspan="2"><h2>Closures</h2></th>
      </tr>
      <tr>
        <td class="pogo">
          <div class="scrollable">
            <pre><code>map each @(file) in (files) into @{ resolve (file) }

map each @(file) in (files) into
    resolve (file)
</code></pre>
          </div>
        </td>
        <td class="javascript">
          <div class="scrollable">
            <pre><code>mapEachInInto(files, <span class="function"><span class="keyword">function</span><span class="params">(file)</span> {</span>
    <span class="keyword">return</span> resolve(file);
});

mapEachInInto(files, <span class="function"><span class="keyword">function</span><span class="params">(file)</span> {</span>
    <span class="keyword">return</span> resolve(file);
});</code></pre>
          </div>
        </td>
      </tr>
      
      <tr>
        <th colspan="2"><h2>Declaring Functions</h2></th>
      </tr>
      <tr>
        <td class="pogo">
          <div class="scrollable">
            <pre><code>one lower than (n) <span class="operator">=</span> n - <span class="number">1</span>

one higher than (n) <span class="operator">=</span>
    n + <span class="number">1</span>

either (thing) or (other) <span class="operator">=</span>
    thing || other

end of the line () <span class="operator">=</span>
    ok then()</code></pre>
          </div>
        </td>
        <td class="javascript">
          <div class="scrollable">
            <pre><code><span class="keyword">var</span> oneLowerThan, oneHigherThan, eitherOr, endOfTheLine;

oneLowerThan = <span class="function"><span class="keyword">function</span><span class="params">(n)</span> {</span>
    <span class="keyword">return</span> n - <span class="number">1</span>;
};

oneHigherThan = <span class="function"><span class="keyword">function</span><span class="params">(n)</span> {</span>
    <span class="keyword">return</span> n + <span class="number">1</span>;
};

eitherOr = <span class="function"><span class="keyword">function</span><span class="params">(thing, other)</span> {</span>
    <span class="keyword">return</span> thing || other;
};

endOfTheLine = <span class="function"><span class="keyword">function</span><span class="params">()</span> {</span>
    <span class="keyword">return</span> okThen();
};</code></pre>
          </div>
        </td>
      </tr>
      
      <tr>
        <th colspan="2"><h2>Dsl</h2></th>
      </tr>
      <tr>
        <td class="pogo">
          <div class="scrollable">
            <pre><code>describe <span class="string">'a horse'</span>
    before
      <span class="keyword">self</span>.horse <span class="operator">=</span> new (Horse)

    context <span class="string">'that is dead'</span>
        before
            <span class="keyword">self</span>.horse.kill()
  
        it <span class="string">'should not move'</span>
            <span class="keyword">self</span>.horse.should not move()</code></pre>
          </div>
        </td>
        <td class="javascript">
          <div class="scrollable">
            <pre><code>describe(<span class="string">"a horse"</span>, <span class="function"><span class="keyword">function</span><span class="params">()</span> {</span>
    before(<span class="function"><span class="keyword">function</span><span class="params">()</span> {</span>
        <span class="keyword">return</span> self.horse = <span class="keyword">new</span> Horse();
    });
    <span class="keyword">return</span> context(<span class="string">"that is dead"</span>, <span class="function"><span class="keyword">function</span><span class="params">()</span> {</span>
        before(<span class="function"><span class="keyword">function</span><span class="params">()</span> {</span>
            <span class="keyword">return</span> self.horse.kill();
        });
        <span class="keyword">return</span> it(<span class="string">"should not move"</span>, <span class="function"><span class="keyword">function</span><span class="params">()</span> {</span>
            <span class="keyword">return</span> self.horse.shouldNotMove();
        });
    });
});</code></pre>
          </div>
        </td>
      </tr>
      
      <tr>
        <th colspan="2"><h2>Event Emitter</h2></th>
      </tr>
      <tr>
        <td class="pogo">
          <div class="scrollable">
            <pre><code>EventEmitter <span class="operator">=</span> require(<span class="string">'events'</span>).EventEmitter

shouter <span class="operator">=</span> new (EventEmitter)

shouter.on <span class="string">'shout'</span>
    console.log <span class="string">"calm down"</span>

shouter.emit <span class="string">'shout'</span></code></pre>
          </div>
        </td>
        <td class="javascript">
          <div class="scrollable">
            <pre><code><span class="keyword">var</span> EventEmitter, shouter;

EventEmitter = require(<span class="string">"events"</span>).EventEmitter;

shouter = <span class="keyword">new</span> EventEmitter();

shouter.on(<span class="string">"shout"</span>, <span class="function"><span class="keyword">function</span><span class="params">()</span> {</span>
    <span class="keyword">return</span> console.log(<span class="string">"calm down"</span>);
});

shouter.emit(<span class="string">"shout"</span>);</code></pre>
          </div>
        </td>
      </tr>
      
      <tr>
        <th colspan="2"><h2>Factorial (Iterative)</h2></th>
      </tr>
      <tr>
        <td class="pogo">
          <div class="scrollable">
            <pre><code>factorial (n) <span class="operator">=</span>
    x <span class="operator">=</span> <span class="number">1</span>
    <span class="keyword">for</span> (i <span class="operator">=</span> <span class="number">2</span><span class="operator">,</span> i &lt;<span class="operator">=</span> n<span class="operator">,</span> i <span class="operator">:</span><span class="operator">=</span> i + <span class="number">1</span>)
        x <span class="operator">:</span><span class="operator">=</span> x * i

    x</code></pre>
          </div>
        </td>
        <td class="javascript">
          <div class="scrollable">
            <pre><code><span class="keyword">var</span> factorial;

factorial = <span class="function"><span class="keyword">function</span><span class="params">(n)</span> {</span>
    <span class="keyword">var</span> x, i;
    x = <span class="number">1</span>;
    <span class="keyword">for</span> (i = <span class="number">2</span>; i &lt;= n; i = i + <span class="number">1</span>) {
        x = x * i;
    }
    <span class="keyword">return</span> x;
};</code></pre>
          </div>
        </td>
      </tr>
      
      <tr>
        <th colspan="2"><h2>Factorial (Recursive)</h2></th>
      </tr>
      <tr>
        <td class="pogo">
          <div class="scrollable">
            <pre><code>factorial (n) <span class="operator">=</span>
    <span class="keyword">if</span> (n <span class="operator">=</span><span class="operator">=</span> <span class="number">0</span>)
        <span class="number">1</span>
    <span class="keyword">else</span>
        n * factorial (n - <span class="number">1</span>)</code></pre>
          </div>
        </td>
        <td class="javascript">
          <div class="scrollable">
            <pre><code><span class="keyword">var</span> factorial;

factorial = <span class="function"><span class="keyword">function</span><span class="params">(n)</span> {</span>
    <span class="keyword">if</span> (n === <span class="number">0</span>) {
        <span class="keyword">return</span> <span class="number">1</span>;
    } <span class="keyword">else</span> {
        <span class="keyword">return</span> n * factorial(n - <span class="number">1</span>);
    }
};</code></pre>
          </div>
        </td>
      </tr>
      
      <tr>
        <th colspan="2"><h2>Fibonacci</h2></th>
      </tr>
      <tr>
        <td class="pogo">
          <div class="scrollable">
            <pre><code>fib (i) <span class="operator">=</span>
    <span class="keyword">if</span> ((i <span class="operator">=</span><span class="operator">=</span> <span class="number">0</span>) || (i <span class="operator">=</span><span class="operator">=</span> <span class="number">1</span>))
        <span class="number">1</span>
    <span class="keyword">else</span>
        fib (i - <span class="number">1</span>) + fib (i - <span class="number">2</span>)</code></pre>
          </div>
        </td>
        <td class="javascript">
          <div class="scrollable">
            <pre><code><span class="keyword">var</span> fib;

fib = <span class="function"><span class="keyword">function</span><span class="params">(i)</span> {</span>
    <span class="keyword">if</span> (i === <span class="number">0</span> || i === <span class="number">1</span>) {
        <span class="keyword">return</span> <span class="number">1</span>;
    } <span class="keyword">else</span> {
        <span class="keyword">return</span> fib(i - <span class="number">1</span>) + fib(i - <span class="number">2</span>);
    }
};</code></pre>
          </div>
        </td>
      </tr>
      
      <tr>
        <th colspan="2"><h2>For</h2></th>
      </tr>
      <tr>
        <td class="pogo">
          <div class="scrollable">
            <pre><code><span class="keyword">for</span> (n <span class="operator">=</span> <span class="number">0</span><span class="operator">,</span> n &lt; <span class="number">10</span><span class="operator">,</span> n <span class="operator">:</span><span class="operator">=</span> n + <span class="number">1</span>)
    console. log (n)</code></pre>
          </div>
        </td>
        <td class="javascript">
          <div class="scrollable">
            <pre><code><span class="keyword">var</span> n;

<span class="keyword">for</span> (n = <span class="number">0</span>; n &lt; <span class="number">10</span>; n = n + <span class="number">1</span>) {
    console.log(n);
}</code></pre>
          </div>
        </td>
      </tr>
      
      <tr>
        <th colspan="2"><h2>For Each</h2></th>
      </tr>
      <tr>
        <td class="pogo">
          <div class="scrollable">
            <pre><code><span class="keyword">for</span> each @(fruit) in (basket)
    gobble(fruit)</code></pre>
          </div>
        </td>
        <td class="javascript">
          <div class="scrollable">
            <pre><code><span class="keyword">var</span> gen1_items, gen2_i, fruit;

gen1_items = basket;

<span class="keyword">for</span> (gen2_i = <span class="number">0</span>; gen2_i &lt; gen1_items.length; ++gen2_i) {
    fruit = gen1_items[gen2_i];
    gobble(fruit);
}</code></pre>
          </div>
        </td>
      </tr>
      
      <tr>
        <th colspan="2"><h2>Function Calls</h2></th>
      </tr>
      <tr>
        <td class="pogo">
          <div class="scrollable">
            <pre><code>y <span class="operator">=</span> compute some value from (z) and return it

md5 hash (read all text from file <span class="string">"sample.txt"</span>)</code></pre>
          </div>
        </td>
        <td class="javascript">
          <div class="scrollable">
            <pre><code><span class="keyword">var</span> y;

y = computeSomeValueFromAndReturnIt(z);

md5Hash(readAllTextFromFile(<span class="string">"sample.txt"</span>));</code></pre>
          </div>
        </td>
      </tr>
      
      <tr>
        <th colspan="2"><h2>Functions Without Arguments</h2></th>
      </tr>
      <tr>
        <td class="pogo">
          <div class="scrollable">
            <pre><code>update page()
hungry <span class="operator">=</span> is lunch time()</code></pre>
          </div>
        </td>
        <td class="javascript">
          <div class="scrollable">
            <pre><code><span class="keyword">var</span> hungry;

updatePage();

hungry = isLunchTime();</code></pre>
          </div>
        </td>
      </tr>
      
      <tr>
        <th colspan="2"><h2>If</h2></th>
      </tr>
      <tr>
        <td class="pogo">
          <div class="scrollable">
            <pre><code><span class="keyword">if</span> (wind speed > <span class="number">20</span>)
    console. log <span class="string">"gone kitesurfing!"</span>
<span class="keyword">else</span>
    console. log <span class="string">"no wind, programming"</span></code></pre>
          </div>
        </td>
        <td class="javascript">
          <div class="scrollable">
            <pre><code><span class="keyword">if</span> (windSpeed > <span class="number">20</span>) {
    console.log(<span class="string">"gone kitesurfing!"</span>);
} <span class="keyword">else</span> {
    console.log(<span class="string">"no wind, programming"</span>);
}</code></pre>
          </div>
        </td>
      </tr>
      
      <tr>
        <th colspan="2"><h2>Method Calls</h2></th>
      </tr>
      <tr>
        <td class="pogo">
          <div class="scrollable">
            <pre><code>file <span class="operator">=</span> open file <span class="string">"README.md"</span>
file. read line()

open file <span class="string">"README.md"</span>. read line()</code></pre>
          </div>
        </td>
        <td class="javascript">
          <div class="scrollable">
            <pre><code><span class="keyword">var</span> file;

file = openFile(<span class="string">"README.md"</span>);

file.readLine();

openFile(<span class="string">"README.md"</span>).readLine();</code></pre>
          </div>
        </td>
      </tr>
      
      <tr>
        <th colspan="2"><h2>Method Chains</h2></th>
      </tr>
      <tr>
        <td class="pogo">
          <div class="scrollable">
            <pre><code>list. map @(i) into
    i + <span class="number">1</span>
.select @(i) <span class="keyword">if</span>
    i &lt; <span class="number">5</span>
.each @(i) <span class="keyword">do</span>
    console. log (i)
</code></pre>
          </div>
        </td>
        <td class="javascript">
          <div class="scrollable">
            <pre><code>list.mapInto(<span class="function"><span class="keyword">function</span><span class="params">(i)</span> {</span>
    <span class="keyword">return</span> i + <span class="number">1</span>;
}).selectIf(<span class="function"><span class="keyword">function</span><span class="params">(i)</span> {</span>
    <span class="keyword">return</span> i &lt; <span class="number">5</span>;
}).eachDo(<span class="function"><span class="keyword">function</span><span class="params">(i)</span> {</span>
    <span class="keyword">return</span> console.log(i);
});</code></pre>
          </div>
        </td>
      </tr>
      
      <tr>
        <th colspan="2"><h2>Multiline Functions</h2></th>
      </tr>
      <tr>
        <td class="pogo">
          <div class="scrollable">
            <pre><code>item <span class="operator">=</span> <span class="number">0</span>

<span class="keyword">do</span>
    print (item)
    item <span class="operator">:</span><span class="operator">=</span> item + <span class="number">1</span>
<span class="keyword">while</span> @{ item &lt; <span class="number">10</span> }</code></pre>
          </div>
        </td>
        <td class="javascript">
          <div class="scrollable">
            <pre><code><span class="keyword">var</span> item;

item = <span class="number">0</span>;

doWhile(<span class="function"><span class="keyword">function</span><span class="params">()</span> {</span>
    print(item);
    <span class="keyword">return</span> item = item + <span class="number">1</span>;
}, <span class="function"><span class="keyword">function</span><span class="params">()</span> {</span>
    <span class="keyword">return</span> item &lt; <span class="number">10</span>;
});</code></pre>
          </div>
        </td>
      </tr>
      
      <tr>
        <th colspan="2"><h2>Objects</h2></th>
      </tr>
      <tr>
        <td class="pogo">
          <div class="scrollable">
            <pre><code>address <span class="operator">=</span> {
    street <span class="operator">=</span> <span class="string">"Fake Street"</span>
    post code <span class="operator">=</span> <span class="string">"123 ABC"</span>
}</code></pre>
          </div>
        </td>
        <td class="javascript">
          <div class="scrollable">
            <pre><code><span class="keyword">var</span> address;

address = {
    street: <span class="string">"Fake Street"</span>,
    postCode: <span class="string">"123 ABC"</span>
};</code></pre>
          </div>
        </td>
      </tr>
      
      <tr>
        <th colspan="2"><h2>Operators</h2></th>
      </tr>
      <tr>
        <td class="pogo">
          <div class="scrollable">
            <pre><code>total height <span class="operator">=</span> header + (item * count) + footer

definitely <span class="operator">=</span> <span class="literal">true</span> @and <span class="literal">true</span>

maybe <span class="operator">=</span> <span class="literal">false</span> @or <span class="literal">true</span>

no way <span class="operator">=</span> (definitely) not

(p1) plus (p2) <span class="operator">=</span> { x <span class="operator">=</span> p1.x + p2.x<span class="operator">,</span> y <span class="operator">=</span> p1.y + p2.y }

a <span class="operator">=</span> { x <span class="operator">=</span> <span class="number">1</span><span class="operator">,</span> y <span class="operator">=</span> <span class="number">2</span> }
b <span class="operator">=</span> { x <span class="operator">=</span> <span class="number">3</span><span class="operator">,</span> y <span class="operator">=</span> <span class="number">4</span> }
a @plus b</code></pre>
          </div>
        </td>
        <td class="javascript">
          <div class="scrollable">
            <pre><code><span class="keyword">var</span> totalHeight, definitely, maybe, noWay, plus, a, b;

totalHeight = header + item * count + footer;

definitely = <span class="literal">true</span> &amp;&amp; <span class="literal">true</span>;

maybe = <span class="literal">false</span> || <span class="literal">true</span>;

noWay = !definitely;

plus = <span class="function"><span class="keyword">function</span><span class="params">(p1, p2)</span> {</span>
    <span class="keyword">return</span> {
        x: p1.x + p2.x,
        y: p1.y + p2.y
    };
};

a = {
    x: <span class="number">1</span>,
    y: <span class="number">2</span>
};

b = {
    x: <span class="number">3</span>,
    y: <span class="number">4</span>
};

plus(a, b);</code></pre>
          </div>
        </td>
      </tr>
      
      <tr>
        <th colspan="2"><h2>Optional Arguments</h2></th>
      </tr>
      <tr>
        <td class="pogo">
          <div class="scrollable">
            <pre><code>connect to mysql database (address<span class="operator">:</span> <span class="string">"1.2.3.4"</span><span class="operator">,</span> port<span class="operator">:</span> <span class="number">3307</span>)

connect to mysql database (readonly<span class="operator">:</span> <span class="literal">true</span>)
</code></pre>
          </div>
        </td>
        <td class="javascript">
          <div class="scrollable">
            <pre><code>connectToMysqlDatabase({
    address: <span class="string">"1.2.3.4"</span>,
    port: <span class="number">3307</span>
});

connectToMysqlDatabase({
    readonly: <span class="literal">true</span>
});</code></pre>
          </div>
        </td>
      </tr>
      
      <tr>
        <th colspan="2"><h2>Options</h2></th>
      </tr>
      <tr>
        <td class="pogo">
          <div class="scrollable">
            <pre><code>connect to (port<span class="operator">:</span> <span class="number">3306</span><span class="operator">,</span> host<span class="operator">:</span> <span class="string">"127.0.0.1"</span>) <span class="operator">=</span>
    console.log <span class="string">"connecting to #(host):#(port)"</span>
</code></pre>
          </div>
        </td>
        <td class="javascript">
          <div class="scrollable">
            <pre><code><span class="keyword">var</span> connectTo;

connectTo = <span class="function"><span class="keyword">function</span><span class="params">(gen1_options)</span> {</span>
    <span class="keyword">var</span> port, host;
    port = gen1_options !== <span class="keyword">void</span> <span class="number">0</span> &amp;&amp; Object.prototype.hasOwnProperty.call(gen1_options, <span class="string">"port"</span>) &amp;&amp; gen1_options.port !== <span class="keyword">void</span> <span class="number">0</span> ? gen1_options.port : <span class="number">3306</span>;
    host = gen1_options !== <span class="keyword">void</span> <span class="number">0</span> &amp;&amp; Object.prototype.hasOwnProperty.call(gen1_options, <span class="string">"host"</span>) &amp;&amp; gen1_options.host !== <span class="keyword">void</span> <span class="number">0</span> ? gen1_options.host : <span class="string">"127.0.0.1"</span>;
    <span class="keyword">return</span> console.log(<span class="string">"connecting to "</span> + host + <span class="string">":"</span> + port);
};</code></pre>
          </div>
        </td>
      </tr>
      
      <tr>
        <th colspan="2"><h2>Regular Expressions</h2></th>
      </tr>
      <tr>
        <td class="pogo">
          <div class="scrollable">
            <pre><code><span class="string">"hot dog"</span>.replace r/d.g/ <span class="string">"potato"</span>

<span class="string">"FOO"</span>.match r/foo/gi</code></pre>
          </div>
        </td>
        <td class="javascript">
          <div class="scrollable">
            <pre><code><span class="string">"hot dog"</span>.replace(<span class="regexp">/d.g/</span>, <span class="string">"potato"</span>);

<span class="string">"FOO"</span>.match(<span class="regexp">/foo/gi</span>);</code></pre>
          </div>
        </td>
      </tr>
      
      <tr>
        <th colspan="2"><h2>Splat Arguments</h2></th>
      </tr>
      <tr>
        <td class="pogo">
          <div class="scrollable">
            <pre><code>foo (args<span class="operator">,</span> ...) <span class="operator">=</span>
     print (args)

foo <span class="number">1</span> [<span class="number">2</span><span class="operator">,</span> <span class="number">3</span>] ... [<span class="number">4</span><span class="operator">,</span> <span class="number">5</span>] ... <span class="number">6</span>
</code></pre>
          </div>
        </td>
        <td class="javascript">
          <div class="scrollable">
            <pre><code><span class="keyword">var</span> foo;

foo = <span class="function"><span class="keyword">function</span><span class="params">()</span> {</span>
    <span class="keyword">var</span> args = Array.prototype.slice.call(arguments, <span class="number">0</span>, arguments.length);
    <span class="keyword">return</span> print(args);
};

foo.apply(<span class="literal">null</span>, [ <span class="number">1</span> ].concat([ <span class="number">2</span>, <span class="number">3</span> ]).concat([ <span class="number">4</span>, <span class="number">5</span> ]).concat([ <span class="number">6</span> ]));</code></pre>
          </div>
        </td>
      </tr>
      
      <tr>
        <th colspan="2"><h2>Strings</h2></th>
      </tr>
      <tr>
        <td class="pogo">
          <div class="scrollable">
            <pre><code><span class="string">'meet you at Jayne''s place'</span>

alan kay <span class="operator">=</span> <span class="string">"The best way to predict the future
            is to invent it."</span>

mood <span class="operator">=</span> <span class="string">"happy"</span>
announce <span class="string">"Feeling #(mood) today"</span>
</code></pre>
          </div>
        </td>
        <td class="javascript">
          <div class="scrollable">
            <pre><code><span class="keyword">var</span> alanKay, mood;

<span class="string">"meet you at Jayne's place"</span>;

alanKay = <span class="string">"The best way to predict the future\nis to invent it."</span>;

mood = <span class="string">"happy"</span>;

announce(<span class="string">"Feeling "</span> + mood + <span class="string">" today"</span>);</code></pre>
          </div>
        </td>
      </tr>
      
      <tr>
        <th colspan="2"><h2>Try Catch</h2></th>
      </tr>
      <tr>
        <td class="pogo">
          <div class="scrollable">
            <pre><code>try
    something messy()
catch (ex)
    console.log <span class="string">"it went horribly wrong"</span>
finally
    better clean up()</code></pre>
          </div>
        </td>
        <td class="javascript">
          <div class="scrollable">
            <pre><code><span class="keyword">try</span> {
    somethingMessy();
} <span class="keyword">catch</span> (ex) {
    console.log(<span class="string">"it went horribly wrong"</span>);
} <span class="keyword">finally</span> {
    betterCleanUp();
}</code></pre>
          </div>
        </td>
      </tr>
      
      <tr>
        <th colspan="2"><h2>Variables</h2></th>
      </tr>
      <tr>
        <td class="pogo">
          <div class="scrollable">
            <pre><code>height <span class="operator">=</span> <span class="number">1025</span>

height <span class="operator">:</span><span class="operator">=</span>
    n <span class="operator">=</span> <span class="number">10</span>
    (n * n * n) + <span class="number">25</span>
</code></pre>
          </div>
        </td>
        <td class="javascript">
          <div class="scrollable">
            <pre><code><span class="keyword">var</span> height;

height = <span class="number">1025</span>;

height = <span class="function"><span class="keyword">function</span><span class="params">()</span> {</span>
    <span class="keyword">var</span> n;
    n = <span class="number">10</span>;
    <span class="keyword">return</span> n * n * n + <span class="number">25</span>;
}();</code></pre>
          </div>
        </td>
      </tr>
      
      <tr>
        <th colspan="2"><h2>Web Server</h2></th>
      </tr>
      <tr>
        <td class="pogo">
          <div class="scrollable">
            <pre><code>http <span class="operator">=</span> require <span class="string">'http'</span>
http. create server @(request<span class="operator">,</span> response)
    response.write (head<span class="operator">:</span> <span class="number">200</span><span class="operator">,</span> <span class="string">"Content-Type"</span><span class="operator">:</span> <span class="string">"text/plain"</span>)
    response.end <span class="string">"Hello World\n"</span>
.listen <span class="number">1337</span></code></pre>
          </div>
        </td>
        <td class="javascript">
          <div class="scrollable">
            <pre><code><span class="keyword">var</span> http;

http = require(<span class="string">"http"</span>);

http.createServer(<span class="function"><span class="keyword">function</span><span class="params">(request, response)</span> {</span>
    response.write({
        head: <span class="number">200</span>,
        <span class="string">"Content-Type"</span>: <span class="string">"text/plain"</span>
    });
    <span class="keyword">return</span> response.end(<span class="string">"Hello World\n"</span>);
}).listen(<span class="number">1337</span>);</code></pre>
          </div>
        </td>
      </tr>
      
      <tr>
        <th colspan="2"><h2>When</h2></th>
      </tr>
      <tr>
        <td class="pogo">
          <div class="scrollable">
            <pre><code>is (expected) (action) <span class="operator">=</span>
    action <span class="keyword">if</span> (actual) matched <span class="operator">=</span>
        <span class="keyword">if</span> (expected <span class="operator">=</span><span class="operator">=</span> actual)
            action

otherwise (action) <span class="operator">=</span>
    action <span class="keyword">if</span> (actual) matched <span class="operator">=</span>
        action

when (actual<span class="operator">,</span> cases) <span class="operator">=</span>
    <span class="keyword">for</span> each @(action <span class="keyword">if</span> matched) in (cases)
        action <span class="operator">=</span> action <span class="keyword">if</span> (actual) matched
        <span class="keyword">if</span> (action)
            return (action ())

print (args<span class="operator">,</span> ...) <span class="operator">=</span> console.log (args<span class="operator">,</span> ...)

x <span class="operator">=</span> <span class="number">2</span>

when (x) [
    is <span class="number">0</span>
        print <span class="string">"x is zero"</span>

    is <span class="number">1</span>
        print <span class="string">"x is one"</span>

    otherwise
        print <span class="string">"x is not zero or one"</span>
]</code></pre>
          </div>
        </td>
        <td class="javascript">
          <div class="scrollable">
            <pre><code><span class="keyword">var</span> is, otherwise, when, print, x;

is = <span class="function"><span class="keyword">function</span><span class="params">(expected, action)</span> {</span>
    <span class="keyword">var</span> actionIfMatched;
    <span class="keyword">return</span> actionIfMatched = <span class="function"><span class="keyword">function</span><span class="params">(actual)</span> {</span>
        <span class="keyword">if</span> (expected === actual) {
            <span class="keyword">return</span> action;
        }
    };
};

otherwise = <span class="function"><span class="keyword">function</span><span class="params">(action)</span> {</span>
    <span class="keyword">var</span> actionIfMatched;
    <span class="keyword">return</span> actionIfMatched = <span class="function"><span class="keyword">function</span><span class="params">(actual)</span> {</span>
        <span class="keyword">return</span> action;
    };
};

when = <span class="function"><span class="keyword">function</span><span class="params">(actual, cases)</span> {</span>
    <span class="keyword">var</span> gen1_items, gen2_i, gen3_forResult;
    gen1_items = <span class="keyword">case</span>s;
    <span class="keyword">for</span> (gen2_i = <span class="number">0</span>; gen2_i &lt; gen1_items.length; ++gen2_i) {
        gen3_forResult = <span class="keyword">void</span> <span class="number">0</span>;
        <span class="keyword">if</span> (<span class="function"><span class="keyword">function</span><span class="params">(gen2_i)</span> {</span>
            <span class="keyword">var</span> actionIfMatched, action;
            actionIfMatched = gen1_items[gen2_i];
            action = actionIfMatched(actual);
            <span class="keyword">if</span> (action) {
                gen3_forResult = action();
                <span class="keyword">return</span> <span class="literal">true</span>;
            }
        }(gen2_i)) {
            <span class="keyword">return</span> gen3_forResult;
        }
    }
    <span class="keyword">return</span> <span class="keyword">void</span> <span class="number">0</span>;
};

print = <span class="function"><span class="keyword">function</span><span class="params">()</span> {</span>
    <span class="keyword">var</span> args = Array.prototype.slice.call(arguments, <span class="number">0</span>, arguments.length);
    <span class="keyword">var</span> gen4_o;
    gen4_o = console;
    <span class="keyword">return</span> gen4_o.log.apply(gen4_o, args);
};

x = <span class="number">2</span>;

when(x, [ is(<span class="number">0</span>, <span class="function"><span class="keyword">function</span><span class="params">()</span> {</span>
    <span class="keyword">return</span> print(<span class="string">"x is zero"</span>);
}), is(<span class="number">1</span>, <span class="function"><span class="keyword">function</span><span class="params">()</span> {</span>
    <span class="keyword">return</span> print(<span class="string">"x is one"</span>);
}), otherwise(<span class="function"><span class="keyword">function</span><span class="params">()</span> {</span>
    <span class="keyword">return</span> print(<span class="string">"x is not zero or one"</span>);
}) ]);</code></pre>
          </div>
        </td>
      </tr>
      
      <tr>
        <th colspan="2"><h2>Async Calls</h2></th>
      </tr>
      <tr>
        <td class="pogo">
          <div class="scrollable">
            <pre><code>web page <span class="operator">=</span> http.get! <span class="string">"http://www.interesting.com"</span>
scrape facts from (web page)</code></pre>
          </div>
        </td>
        <td class="javascript">
          <div class="scrollable">
            <pre><code>http.get(<span class="string">"http://www.interesting.com"</span>, <span class="function"><span class="keyword">function</span><span class="params">(gen1_error, gen2_asyncResult)</span> {</span>
    <span class="keyword">var</span> webPage;
    <span class="keyword">if</span> (gen1_error) {
        continuation(gen1_error);
    } <span class="keyword">else</span> {
        <span class="keyword">try</span> {
            webPage = gen2_asyncResult;
            continuation(<span class="keyword">void</span> <span class="number">0</span>, scrapeFactsFrom(webPage));
        } <span class="keyword">catch</span> (gen3_exception) {
            continuation(gen3_exception);
        }
    }
});</code></pre>
          </div>
        </td>
      </tr>
      
      <tr>
        <th colspan="2"><h2>Async Continuations</h2></th>
      </tr>
      <tr>
        <td class="pogo">
          <div class="scrollable">
            <pre><code>current continuation (callback) <span class="operator">=</span>
    continuation () <span class="operator">=</span>
        callback (nil<span class="operator">,</span> continuation)

    callback (nil<span class="operator">,</span> continuation)

n <span class="operator">=</span> <span class="number">0</span>

cont <span class="operator">=</span> current continuation!

console.log (n)
n <span class="operator">:</span><span class="operator">=</span> n + <span class="number">1</span>

<span class="keyword">if</span> (n &lt; <span class="number">10</span>)
    cont ()</code></pre>
          </div>
        </td>
        <td class="javascript">
          <div class="scrollable">
            <pre><code><span class="keyword">var</span> currentContinuation, n;

currentContinuation = <span class="function"><span class="keyword">function</span><span class="params">(callback)</span> {</span>
    <span class="keyword">var</span> continuation;
    continuation = <span class="function"><span class="keyword">function</span><span class="params">()</span> {</span>
        callback(<span class="keyword">void</span> <span class="number">0</span>, continuation);
    };
    callback(<span class="keyword">void</span> <span class="number">0</span>, continuation);
};

n = <span class="number">0</span>;

currentContinuation(<span class="function"><span class="keyword">function</span><span class="params">(gen1_error, gen2_asyncResult)</span> {</span>
    <span class="keyword">var</span> cont;
    <span class="keyword">if</span> (gen1_error) {
        continuation(gen1_error);
    } <span class="keyword">else</span> {
        <span class="keyword">try</span> {
            cont = gen2_asyncResult;
            console.log(n);
            n = n + <span class="number">1</span>;
            <span class="keyword">if</span> (n &lt; <span class="number">10</span>) {
                continuation(<span class="keyword">void</span> <span class="number">0</span>, cont());
            } <span class="keyword">else</span> {
                continuation();
            }
        } <span class="keyword">catch</span> (gen3_exception) {
            continuation(gen3_exception);
        }
    }
});</code></pre>
          </div>
        </td>
      </tr>
      
      <tr>
        <th colspan="2"><h2>Async Coroutines</h2></th>
      </tr>
      <tr>
        <td class="pogo">
          <div class="scrollable">
            <pre><code>last yield continuation <span class="operator">=</span> nil
last result continuation <span class="operator">=</span> nil

yield (n<span class="operator">,</span> yield continuation) <span class="operator">=</span>
    last yield continuation <span class="operator">:</span><span class="operator">=</span> yield continuation
    last result continuation (nil<span class="operator">,</span> n)

coroutine (block) <span class="operator">=</span>
    run (result continuation) <span class="operator">=</span>
        last result continuation <span class="operator">:</span><span class="operator">=</span> result continuation

        <span class="keyword">if</span> (last yield continuation)
            last yield continuation ()
        <span class="keyword">else</span>
            block
                last yield continuation <span class="operator">:</span><span class="operator">=</span> nil
                last result continuation <span class="operator">:</span><span class="operator">=</span> nil

strings <span class="operator">=</span> coroutine
    yield! <span class="number">1</span>
    yield! <span class="number">2</span>
    yield! <span class="number">3</span>

console.log (strings!)
console.log (strings!)
console.log (strings!)
console.log <span class="string">'finished'</span></code></pre>
          </div>
        </td>
        <td class="javascript">
          <div class="scrollable">
            <pre><code><span class="keyword">var</span> lastYieldContinuation, lastResultContinuation, yield, coroutine, strings;

lastYieldContinuation = <span class="keyword">void</span> <span class="number">0</span>;

lastResultContinuation = <span class="keyword">void</span> <span class="number">0</span>;

yield = <span class="function"><span class="keyword">function</span><span class="params">(n, yieldContinuation)</span> {</span>
    lastYieldContinuation = yieldContinuation;
    <span class="keyword">return</span> lastResultContinuation(<span class="keyword">void</span> <span class="number">0</span>, n);
};

coroutine = <span class="function"><span class="keyword">function</span><span class="params">(block)</span> {</span>
    <span class="keyword">var</span> run;
    <span class="keyword">return</span> run = <span class="function"><span class="keyword">function</span><span class="params">(resultContinuation)</span> {</span>
        lastResultContinuation = resultContinuation;
        <span class="keyword">if</span> (lastYieldContinuation) {
            <span class="keyword">return</span> lastYieldContinuation();
        } <span class="keyword">else</span> {
            <span class="keyword">return</span> block(<span class="function"><span class="keyword">function</span><span class="params">()</span> {</span>
                lastYieldContinuation = <span class="keyword">void</span> <span class="number">0</span>;
                <span class="keyword">return</span> lastResultContinuation = <span class="keyword">void</span> <span class="number">0</span>;
            });
        }
    };
};

strings = coroutine(<span class="function"><span class="keyword">function</span><span class="params">(continuation)</span> {</span>
    <span class="keyword">var</span> gen1_arguments = Array.prototype.slice.call(arguments, <span class="number">0</span>, arguments.length - <span class="number">1</span>);
    continuation = arguments[arguments.length - <span class="number">1</span>];
    <span class="keyword">if</span> (!(continuation <span class="keyword">instanceof</span> Function)) {
        <span class="keyword">throw</span> <span class="keyword">new</span> Error(<span class="string">"asynchronous function called synchronously"</span>);
    }
    yield(<span class="number">1</span>, <span class="function"><span class="keyword">function</span><span class="params">(gen2_error, gen3_asyncResult)</span> {</span>
        <span class="keyword">if</span> (gen2_error) {
            continuation(gen2_error);
        } <span class="keyword">else</span> {
            <span class="keyword">try</span> {
                gen3_asyncResult;
                yield(<span class="number">2</span>, <span class="function"><span class="keyword">function</span><span class="params">(gen4_error, gen5_asyncResult)</span> {</span>
                    <span class="keyword">if</span> (gen4_error) {
                        continuation(gen4_error);
                    } <span class="keyword">else</span> {
                        <span class="keyword">try</span> {
                            gen5_asyncResult;
                            yield(<span class="number">3</span>, continuation);
                        } <span class="keyword">catch</span> (gen6_exception) {
                            continuation(gen6_exception);
                        }
                    }
                });
            } <span class="keyword">catch</span> (gen7_exception) {
                continuation(gen7_exception);
            }
        }
    });
});

strings(<span class="function"><span class="keyword">function</span><span class="params">(gen8_error, gen9_asyncResult)</span> {</span>
    <span class="keyword">if</span> (gen8_error) {
        continuation(gen8_error);
    } <span class="keyword">else</span> {
        <span class="keyword">try</span> {
            console.log(gen9_asyncResult);
            strings(<span class="function"><span class="keyword">function</span><span class="params">(gen10_error, gen11_asyncResult)</span> {</span>
                <span class="keyword">if</span> (gen10_error) {
                    continuation(gen10_error);
                } <span class="keyword">else</span> {
                    <span class="keyword">try</span> {
                        console.log(gen11_asyncResult);
                        strings(<span class="function"><span class="keyword">function</span><span class="params">(gen12_error, gen13_asyncResult)</span> {</span>
                            <span class="keyword">if</span> (gen12_error) {
                                continuation(gen12_error);
                            } <span class="keyword">else</span> {
                                <span class="keyword">try</span> {
                                    console.log(gen13_asyncResult);
                                    continuation(<span class="keyword">void</span> <span class="number">0</span>, console.log(<span class="string">"finished"</span>));
                                } <span class="keyword">catch</span> (gen14_exception) {
                                    continuation(gen14_exception);
                                }
                            }
                        });
                    } <span class="keyword">catch</span> (gen15_exception) {
                        continuation(gen15_exception);
                    }
                }
            });
        } <span class="keyword">catch</span> (gen16_exception) {
            continuation(gen16_exception);
        }
    }
});</code></pre>
          </div>
        </td>
      </tr>
      
      <tr>
        <th colspan="2"><h2>Async For</h2></th>
      </tr>
      <tr>
        <td class="pogo">
          <div class="scrollable">
            <pre><code><span class="keyword">for</span> (n <span class="operator">=</span> <span class="number">0</span><span class="operator">,</span> n &lt; <span class="number">3</span><span class="operator">,</span> n <span class="operator">:</span><span class="operator">=</span> n + <span class="number">1</span>)
    send letter! (n)

all letters sent()</code></pre>
          </div>
        </td>
        <td class="javascript">
          <div class="scrollable">
            <pre><code><span class="keyword">var</span> gen1_asyncFor;

gen1_asyncFor = <span class="function"><span class="keyword">function</span><span class="params">(test, incr, loop, cb)</span> {</span>
    <span class="keyword">try</span> {
        <span class="keyword">var</span> testAndLoop = <span class="function"><span class="keyword">function</span><span class="params">()</span> {</span>
            test(<span class="function"><span class="keyword">function</span><span class="params">(error, anotherLoop)</span> {</span>
                <span class="keyword">if</span> (error) {
                    cb(error);
                } <span class="keyword">else</span> {
                    <span class="keyword">if</span> (anotherLoop) {
                        loop(incrTestAndLoop);
                    } <span class="keyword">else</span> {
                        cb();
                    }
                }
            });
        };
        <span class="keyword">var</span> incrTestAndLoop = <span class="function"><span class="keyword">function</span><span class="params">(error)</span> {</span>
            <span class="keyword">if</span> (error) {
                cb(error);
            } <span class="keyword">else</span> {
                incr(<span class="function"><span class="keyword">function</span><span class="params">(error)</span> {</span>
                    <span class="keyword">if</span> (error) {
                        cb(error);
                    } <span class="keyword">else</span> {
                        testAndLoop();
                    }
                });
            }
        };
        testAndLoop();
    } <span class="keyword">catch</span> (error) {
        cb(error);
    }
};

(<span class="function"><span class="keyword">function</span><span class="params">(continuation)</span> {</span>
    <span class="keyword">var</span> gen2_arguments = Array.prototype.slice.call(arguments, <span class="number">0</span>, arguments.length - <span class="number">1</span>);
    continuation = arguments[arguments.length - <span class="number">1</span>];
    <span class="keyword">if</span> (!(continuation <span class="keyword">instanceof</span> Function)) {
        <span class="keyword">throw</span> <span class="keyword">new</span> Error(<span class="string">"asynchronous function called synchronously"</span>);
    }
    <span class="keyword">var</span> n;
    n = <span class="number">0</span>;
    gen1_asyncFor(<span class="function"><span class="keyword">function</span><span class="params">(continuation)</span> {</span>
        <span class="keyword">var</span> gen3_arguments = Array.prototype.slice.call(arguments, <span class="number">0</span>, arguments.length - <span class="number">1</span>);
        continuation = arguments[arguments.length - <span class="number">1</span>];
        <span class="keyword">if</span> (!(continuation <span class="keyword">instanceof</span> Function)) {
            <span class="keyword">throw</span> <span class="keyword">new</span> Error(<span class="string">"asynchronous function called synchronously"</span>);
        }
        continuation(<span class="keyword">void</span> <span class="number">0</span>, n &lt; <span class="number">3</span>);
    }, <span class="function"><span class="keyword">function</span><span class="params">(continuation)</span> {</span>
        <span class="keyword">var</span> gen4_arguments = Array.prototype.slice.call(arguments, <span class="number">0</span>, arguments.length - <span class="number">1</span>);
        continuation = arguments[arguments.length - <span class="number">1</span>];
        <span class="keyword">if</span> (!(continuation <span class="keyword">instanceof</span> Function)) {
            <span class="keyword">throw</span> <span class="keyword">new</span> Error(<span class="string">"asynchronous function called synchronously"</span>);
        }
        continuation(<span class="keyword">void</span> <span class="number">0</span>, n = n + <span class="number">1</span>);
    }, <span class="function"><span class="keyword">function</span><span class="params">(continuation)</span> {</span>
        <span class="keyword">var</span> gen5_arguments = Array.prototype.slice.call(arguments, <span class="number">0</span>, arguments.length - <span class="number">1</span>);
        continuation = arguments[arguments.length - <span class="number">1</span>];
        <span class="keyword">if</span> (!(continuation <span class="keyword">instanceof</span> Function)) {
            <span class="keyword">throw</span> <span class="keyword">new</span> Error(<span class="string">"asynchronous function called synchronously"</span>);
        }
        sendLetter(n, continuation);
    }, continuation);
})(<span class="function"><span class="keyword">function</span><span class="params">(gen6_error, gen7_asyncResult)</span> {</span>
    <span class="keyword">if</span> (gen6_error) {
        continuation(gen6_error);
    } <span class="keyword">else</span> {
        <span class="keyword">try</span> {
            gen7_asyncResult;
            continuation(<span class="keyword">void</span> <span class="number">0</span>, allLettersSent());
        } <span class="keyword">catch</span> (gen8_exception) {
            continuation(gen8_exception);
        }
    }
});</code></pre>
          </div>
        </td>
      </tr>
      
      <tr>
        <th colspan="2"><h2>Async Fork</h2></th>
      </tr>
      <tr>
        <td class="pogo">
          <div class="scrollable">
            <pre><code>fs <span class="operator">=</span> require <span class="string">'fs'</span>

fork (block) <span class="operator">=</span> block @{}

fork
    console.log <span class="string">"reading contents of file #(__filename)"</span>
    contents <span class="operator">=</span> fs.read file (__filename<span class="operator">,</span>  <span class="string">'utf-8'</span>)!
    console.log (<span class="string">"contents of #(__filename):"</span>)
    process.stdout.write (contents)

console.log <span class="string">'processing other stuff'</span></code></pre>
          </div>
        </td>
        <td class="javascript">
          <div class="scrollable">
            <pre><code><span class="keyword">var</span> fs, fork;

fs = require(<span class="string">"fs"</span>);

fork = <span class="function"><span class="keyword">function</span><span class="params">(block)</span> {</span>
    <span class="keyword">return</span> block(<span class="function"><span class="keyword">function</span><span class="params">()</span> {</span>});
};

fork(<span class="function"><span class="keyword">function</span><span class="params">(continuation)</span> {</span>
    <span class="keyword">var</span> gen1_arguments = Array.prototype.slice.call(arguments, <span class="number">0</span>, arguments.length - <span class="number">1</span>);
    continuation = arguments[arguments.length - <span class="number">1</span>];
    <span class="keyword">if</span> (!(continuation <span class="keyword">instanceof</span> Function)) {
        <span class="keyword">throw</span> <span class="keyword">new</span> Error(<span class="string">"asynchronous function called synchronously"</span>);
    }
    console.log(<span class="string">"reading contents of file "</span> + __filename);
    fs.readFile(__filename, <span class="string">"utf-8"</span>, <span class="function"><span class="keyword">function</span><span class="params">(gen2_error, gen3_asyncResult)</span> {</span>
        <span class="keyword">var</span> contents;
        <span class="keyword">if</span> (gen2_error) {
            continuation(gen2_error);
        } <span class="keyword">else</span> {
            <span class="keyword">try</span> {
                contents = gen3_asyncResult;
                console.log(<span class="string">"contents of "</span> + __filename + <span class="string">":"</span>);
                continuation(<span class="keyword">void</span> <span class="number">0</span>, process.stdout.write(contents));
            } <span class="keyword">catch</span> (gen4_exception) {
                continuation(gen4_exception);
            }
        }
    });
});

console.log(<span class="string">"processing other stuff"</span>);</code></pre>
          </div>
        </td>
      </tr>
      
      <tr>
        <th colspan="2"><h2>Async Futures</h2></th>
      </tr>
      <tr>
        <td class="pogo">
          <div class="scrollable">
            <pre><code>a <span class="operator">=</span> fs.stat? <span class="string">'a.txt'</span>
b <span class="operator">=</span> fs.stat? <span class="string">'b.txt'</span>

console.log <span class="string">"size of a.txt is #(a!.size)"</span>
console.log <span class="string">"size of b.txt is #(b!.size)"</span>
</code></pre>
          </div>
        </td>
        <td class="javascript">
          <div class="scrollable">
            <pre><code><span class="keyword">var</span> gen1_future, a, b;

gen1_future = <span class="function"><span class="keyword">function</span><span class="params">(action)</span> {</span>
    <span class="keyword">var</span> operationComplete = <span class="literal">false</span>;
    <span class="keyword">var</span> operationError, operationResult;
    <span class="keyword">var</span> futureCallbacks = [];
    <span class="function"><span class="keyword">function</span> <span class="title">callback</span><span class="params">(error, result)</span> {</span>
        operationComplete = <span class="literal">true</span>;
        operationError = error;
        operationResult = result;
        <span class="keyword">for</span> (<span class="keyword">var</span> n = <span class="number">0</span>; n &lt; futureCallbacks.length; n++) {
            futureCallbacks[n](operationError, operationResult);
        }
    }
    <span class="keyword">try</span> {
        action(callback);
    } <span class="keyword">catch</span> (error) {
        operationComplete = <span class="literal">true</span>;
        operationError = error;
    }
    <span class="keyword">return</span> <span class="function"><span class="keyword">function</span><span class="params">(callback)</span> {</span>
        <span class="keyword">if</span> (operationComplete) {
            callback(operationError, operationResult);
        } <span class="keyword">else</span> {
            futureCallbacks.push(callback);
        }
    };
};

a = gen1_future(<span class="function"><span class="keyword">function</span><span class="params">(continuation)</span> {</span>
    fs.stat(<span class="string">"a.txt"</span>, continuation);
});

b = gen1_future(<span class="function"><span class="keyword">function</span><span class="params">(continuation)</span> {</span>
    fs.stat(<span class="string">"b.txt"</span>, continuation);
});

a(<span class="function"><span class="keyword">function</span><span class="params">(gen2_error, gen3_asyncResult)</span> {</span>
    <span class="keyword">if</span> (gen2_error) {
        continuation(gen2_error);
    } <span class="keyword">else</span> {
        <span class="keyword">try</span> {
            console.log(<span class="string">"size of a.txt is "</span> + gen3_asyncResult.size);
            b(<span class="function"><span class="keyword">function</span><span class="params">(gen4_error, gen5_asyncResult)</span> {</span>
                <span class="keyword">if</span> (gen4_error) {
                    continuation(gen4_error);
                } <span class="keyword">else</span> {
                    <span class="keyword">try</span> {
                        continuation(<span class="keyword">void</span> <span class="number">0</span>, console.log(<span class="string">"size of b.txt is "</span> + gen5_asyncResult.size));
                    } <span class="keyword">catch</span> (gen6_exception) {
                        continuation(gen6_exception);
                    }
                }
            });
        } <span class="keyword">catch</span> (gen7_exception) {
            continuation(gen7_exception);
        }
    }
});</code></pre>
          </div>
        </td>
      </tr>
      
      <tr>
        <th colspan="2"><h2>Async If</h2></th>
      </tr>
      <tr>
        <td class="pogo">
          <div class="scrollable">
            <pre><code><span class="keyword">if</span> ((intruders) are dangerous)
    kill! (intruders)
<span class="keyword">else</span>
    call the cops about! (intruders)

keep watch!</code></pre>
          </div>
        </td>
        <td class="javascript">
          <div class="scrollable">
            <pre><code><span class="keyword">var</span> gen1_asyncIfElse;

gen1_asyncIfElse = <span class="function"><span class="keyword">function</span><span class="params">(condition, thenBody, elseBody, cb)</span> {</span>
    <span class="keyword">if</span> (condition) {
        <span class="keyword">try</span> {
            thenBody(cb);
        } <span class="keyword">catch</span> (ex) {
            cb(ex);
        }
    } <span class="keyword">else</span> {
        <span class="keyword">try</span> {
            elseBody(cb);
        } <span class="keyword">catch</span> (ex) {
            cb(ex);
        }
    }
};

gen1_asyncIfElse(areDangerous(intruders), <span class="function"><span class="keyword">function</span><span class="params">(continuation)</span> {</span>
    <span class="keyword">var</span> gen2_arguments = Array.prototype.slice.call(arguments, <span class="number">0</span>, arguments.length - <span class="number">1</span>);
    continuation = arguments[arguments.length - <span class="number">1</span>];
    <span class="keyword">if</span> (!(continuation <span class="keyword">instanceof</span> Function)) {
        <span class="keyword">throw</span> <span class="keyword">new</span> Error(<span class="string">"asynchronous function called synchronously"</span>);
    }
    kill(intruders, continuation);
}, <span class="function"><span class="keyword">function</span><span class="params">(continuation)</span> {</span>
    <span class="keyword">var</span> gen3_arguments = Array.prototype.slice.call(arguments, <span class="number">0</span>, arguments.length - <span class="number">1</span>);
    continuation = arguments[arguments.length - <span class="number">1</span>];
    <span class="keyword">if</span> (!(continuation <span class="keyword">instanceof</span> Function)) {
        <span class="keyword">throw</span> <span class="keyword">new</span> Error(<span class="string">"asynchronous function called synchronously"</span>);
    }
    callTheCopsAbout(intruders, continuation);
}, <span class="function"><span class="keyword">function</span><span class="params">(gen4_error, gen5_asyncResult)</span> {</span>
    <span class="keyword">if</span> (gen4_error) {
        continuation(gen4_error);
    } <span class="keyword">else</span> {
        <span class="keyword">try</span> {
            gen5_asyncResult;
            keepWatch(continuation);
        } <span class="keyword">catch</span> (gen6_exception) {
            continuation(gen6_exception);
        }
    }
});</code></pre>
          </div>
        </td>
      </tr>
      
      <tr>
        <th colspan="2"><h2>Async Try Catch</h2></th>
      </tr>
      <tr>
        <td class="pogo">
          <div class="scrollable">
            <pre><code>record <span class="operator">=</span> nil

try
    database <span class="operator">=</span> connect to the database!
    record <span class="operator">:</span><span class="operator">=</span> database.query!
catch (error)
    exit the program because of (error)!
finally
    database.close!

console.log(<span class="string">"RECORD FOUND: #(record)"</span>)</code></pre>
          </div>
        </td>
        <td class="javascript">
          <div class="scrollable">
            <pre><code><span class="keyword">var</span> gen1_asyncTry, record;

gen1_asyncTry = <span class="function"><span class="keyword">function</span><span class="params">(body, catchBody, finallyBody, cb)</span> {</span>
    <span class="keyword">var</span> callbackCalled = <span class="literal">false</span>;
    <span class="keyword">var</span> callback = <span class="function"><span class="keyword">function</span><span class="params">(error, result)</span> {</span>
        <span class="keyword">if</span> (!callbackCalled) {
            callbackCalled = <span class="literal">true</span>;
            cb(error, result);
        }
    };
    <span class="keyword">try</span> {
        body(<span class="function"><span class="keyword">function</span><span class="params">(error, result)</span> {</span>
            <span class="keyword">if</span> (error) {
                <span class="keyword">if</span> (finallyBody &amp;&amp; catchBody) {
                    <span class="keyword">try</span> {
                        catchBody(error, <span class="function"><span class="keyword">function</span><span class="params">(error, result)</span> {</span>
                            <span class="keyword">try</span> {
                                finallyBody(<span class="function"><span class="keyword">function</span><span class="params">(finallyError)</span> {</span>
                                    callback(finallyError || error, finallyError || error ? undefined : result);
                                });
                            } <span class="keyword">catch</span> (error) {
                                callback(error);
                            }
                        });
                    } <span class="keyword">catch</span> (error) {
                        <span class="keyword">try</span> {
                            finallyBody(<span class="function"><span class="keyword">function</span><span class="params">(finallyError)</span> {</span>
                                callback(finallyError || error);
                            });
                        } <span class="keyword">catch</span> (error) {
                            callback(error);
                        }
                    }
                } <span class="keyword">else</span> <span class="keyword">if</span> (catchBody) {
                    <span class="keyword">try</span> {
                        catchBody(error, callback);
                    } <span class="keyword">catch</span> (error) {
                        callback(error);
                    }
                } <span class="keyword">else</span> {
                    <span class="keyword">try</span> {
                        finallyBody(<span class="function"><span class="keyword">function</span><span class="params">(finallyError)</span> {</span>
                            callback(finallyError || error, finallyError ? undefined : result);
                        });
                    } <span class="keyword">catch</span> (error) {
                        callback(error);
                    }
                }
            } <span class="keyword">else</span> {
                <span class="keyword">if</span> (finallyBody) {
                    <span class="keyword">try</span> {
                        finallyBody(<span class="function"><span class="keyword">function</span><span class="params">(finallyError)</span> {</span>
                            callback(finallyError, finallyError ? undefined : result);
                        });
                    } <span class="keyword">catch</span> (error) {
                        callback(error);
                    }
                } <span class="keyword">else</span> {
                    callback(undefined, result);
                }
            }
        });
    } <span class="keyword">catch</span> (error) {
        <span class="keyword">if</span> (finallyBody &amp;&amp; catchBody) {
            <span class="keyword">try</span> {
                catchBody(error, <span class="function"><span class="keyword">function</span><span class="params">(error, result)</span> {</span>
                    <span class="keyword">try</span> {
                        finallyBody(<span class="function"><span class="keyword">function</span><span class="params">(finallyError)</span> {</span>
                            callback(finallyError || error, finallyError ? undefined : result);
                        });
                    } <span class="keyword">catch</span> (error) {
                        callback(error);
                    }
                });
            } <span class="keyword">catch</span> (error) {
                <span class="keyword">try</span> {
                    finallyBody(<span class="function"><span class="keyword">function</span><span class="params">(finallyError)</span> {</span>
                        callback(finallyError || error);
                    });
                } <span class="keyword">catch</span> (error) {
                    callback(error);
                }
            }
        } <span class="keyword">else</span> <span class="keyword">if</span> (catchBody) {
            <span class="keyword">try</span> {
                catchBody(error, callback);
            } <span class="keyword">catch</span> (error) {
                callback(error);
            }
        } <span class="keyword">else</span> {
            <span class="keyword">try</span> {
                finallyBody(<span class="function"><span class="keyword">function</span><span class="params">(finallyError)</span> {</span>
                    callback(finallyError || error);
                });
            } <span class="keyword">catch</span> (error) {
                callback(error);
            }
        }
    }
};

record = <span class="keyword">void</span> <span class="number">0</span>;

gen1_asyncTry(<span class="function"><span class="keyword">function</span><span class="params">(continuation)</span> {</span>
    <span class="keyword">var</span> gen2_arguments = Array.prototype.slice.call(arguments, <span class="number">0</span>, arguments.length - <span class="number">1</span>);
    continuation = arguments[arguments.length - <span class="number">1</span>];
    <span class="keyword">if</span> (!(continuation <span class="keyword">instanceof</span> Function)) {
        <span class="keyword">throw</span> <span class="keyword">new</span> Error(<span class="string">"asynchronous function called synchronously"</span>);
    }
    connectToTheDatabase(<span class="function"><span class="keyword">function</span><span class="params">(gen3_error, gen4_asyncResult)</span> {</span>
        <span class="keyword">var</span> database;
        <span class="keyword">if</span> (gen3_error) {
            continuation(gen3_error);
        } <span class="keyword">else</span> {
            <span class="keyword">try</span> {
                database = gen4_asyncResult;
                database.query(<span class="function"><span class="keyword">function</span><span class="params">(gen5_error, gen6_asyncResult)</span> {</span>
                    <span class="keyword">if</span> (gen5_error) {
                        continuation(gen5_error);
                    } <span class="keyword">else</span> {
                        <span class="keyword">try</span> {
                            continuation(<span class="keyword">void</span> <span class="number">0</span>, record = gen6_asyncResult);
                        } <span class="keyword">catch</span> (gen7_exception) {
                            continuation(gen7_exception);
                        }
                    }
                });
            } <span class="keyword">catch</span> (gen8_exception) {
                continuation(gen8_exception);
            }
        }
    });
}, <span class="function"><span class="keyword">function</span><span class="params">(error, continuation)</span> {</span>
    <span class="keyword">var</span> gen9_arguments = Array.prototype.slice.call(arguments, <span class="number">0</span>, arguments.length - <span class="number">1</span>);
    continuation = arguments[arguments.length - <span class="number">1</span>];
    <span class="keyword">if</span> (!(continuation <span class="keyword">instanceof</span> Function)) {
        <span class="keyword">throw</span> <span class="keyword">new</span> Error(<span class="string">"asynchronous function called synchronously"</span>);
    }
    error = gen9_arguments[<span class="number">0</span>];
    exitTheProgramBecauseOf(error, continuation);
}, <span class="function"><span class="keyword">function</span><span class="params">(continuation)</span> {</span>
    <span class="keyword">var</span> gen10_arguments = Array.prototype.slice.call(arguments, <span class="number">0</span>, arguments.length - <span class="number">1</span>);
    continuation = arguments[arguments.length - <span class="number">1</span>];
    <span class="keyword">if</span> (!(continuation <span class="keyword">instanceof</span> Function)) {
        <span class="keyword">throw</span> <span class="keyword">new</span> Error(<span class="string">"asynchronous function called synchronously"</span>);
    }
    database.close(continuation);
}, <span class="function"><span class="keyword">function</span><span class="params">(gen11_error, gen12_asyncResult)</span> {</span>
    <span class="keyword">if</span> (gen11_error) {
        continuation(gen11_error);
    } <span class="keyword">else</span> {
        <span class="keyword">try</span> {
            gen12_asyncResult;
            continuation(<span class="keyword">void</span> <span class="number">0</span>, console.log(<span class="string">"RECORD FOUND: "</span> + record));
        } <span class="keyword">catch</span> (gen13_exception) {
            continuation(gen13_exception);
        }
    }
});</code></pre>
          </div>
        </td>
      </tr>
      
    </table>

  </body>
</html>
